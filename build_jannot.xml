<?xml version="1.0"?>
<project
    name="JAnnot"
    basedir="."
    default="dist" >

    <property
        name="version"
        value="2500" />

    <property
        name="src"
        value="src/" />

    <property
        name="build"
        value="build" />

    <property
        name="project"
        value="jannot" />

    <property
        name="dist"
        value="${project}-${version}" />

    <property
        name="jar"
        value="${project}-${version}.jar" />

    <target name="junit" >

        <mkdir dir="build.test" />

        <copy todir="build.test" >

            <fileset dir="${src}" >

                <include name="net/sf/jannot/aamapping/**" />

                <include name="**/*.txt" />
            </fileset>
        </copy>

        <javac
            debug="true"
            debuglevel="lines,vars,source"
            destdir="build.test"
            source="1.6"
            target="1.6" >

            <src path="${src}" />

            <src path="test/src" />

            <classpath>

                <fileset dir="lib/" >

                    <include name="*.jar" />
                </fileset>

                <fileset dir="lib_compile/" >

                    <include name="*.jar" />
                </fileset>
            </classpath>
        </javac>
        <!-- <taskdef name="unit-lib" classpath="" /> -->

        <junit
            errorProperty="test.failed"
            failureProperty="test.failed"
            fork="no" >

            <formatter type="plain" />

            <classpath>

                <fileset dir="lib/" >

                    <include name="*.jar" />
                </fileset>

                <fileset dir="lib_compile/" >

                    <include name="*.jar" />
                </fileset>

                <pathelement location="build.test/" />
            </classpath>

            <batchtest>

                <fileset dir="build.test" >

                    <include name="**/Test*.class" />
                </fileset>
            </batchtest>
        </junit>

        <fail
            if="test.failed"
            message="Tests failed. Please see test reports" />
		<echo message="Tests have complete successfully!"/>
        <delete
            dir="build.test"
            failonerror="false" />
    </target>

    <target name="dist" >

        <delete
            dir="${build}"
            failonerror="false" />

        <delete
            dir="${dist}"
            failonerror="false" />

        <mkdir dir="${build}" />

        <mkdir dir="${dist}" />

        <mkdir dir="sourcebuild" />

        <copy todir="sourcebuild" >

            <fileset dir="${src}" >

                <include name="**/*.java" />

                <include name="**/*.txt" />

                <include name="net/sf/jannot/aamapping/**" />
            </fileset>
        </copy>

        <replaceregexp
            match="%HEADER%"
            replace="This file is part of JAnnot${line.separator}
* ${line.separator}
* Copyright (C) 2007-2013 Thomas Abeel${line.separator}
* ${line.separator}
* This program is free software: you can redistribute it and/or modify${line.separator}
* it under the terms of the GNU General Public License as published by${line.separator}
* the Free Software Foundation, either version 3 of the License, or${line.separator}
* (at your option) any later version.${line.separator}
*${line.separator}
* This program is distributed in the hope that it will be useful,${line.separator}
* but WITHOUT ANY WARRANTY; without even the implied warranty of${line.separator}
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the${line.separator}
* GNU General Public License for more details.${line.separator}
*${line.separator}
* You should have received a copy of the GNU General Public License${line.separator}
* along with this program.  If not, see http://www.gnu.org/licenses/.${line.separator}
*${line.separator}
* Project: http://genomeview.sourceforge.net/" >

            <fileset dir="sourcebuild" >

                <include name="**/*.java" />
            </fileset>
        </replaceregexp>

        <zip
            basedir="sourcebuild"
            destfile="${dist}/${project}-${version}-src.zip" />

        <delete
            dir="sourcebuild"
            failonerror="false" />

        <copy todir="${dist}" >

            <fileset dir="${src}" >

                <include name="*.txt" />
            </fileset>
             <fileset dir="lib/" >

                <include name="*.jar" />
            </fileset>
        </copy>

        <javac
            debug="true"
            debuglevel="lines,vars,source"
            destdir="${build}"
            excludes="junit/*.java"
            source="1.6"
            srcdir="${src}"
            target="1.6" >

            <classpath>

                <fileset dir="lib/" >

                    <include name="*.jar" />
                </fileset>
            </classpath>
        </javac>

        <copy todir="${build}" >

            <fileset dir="${src}" >

                <include name="net/sf/jannot/aamapping/**" />

                <include name="**/*.txt" />
            </fileset>
        </copy>

        <jar
            basedir="${build}"
            destfile="${dist}/${jar}" >
        </jar>

        <javadoc
            author="true"
            destdir="${dist}/doc"
            use="true"
            version="true"
            windowtitle="JAnnot ${version}" >

            <classpath>

                <fileset dir="lib/" >

                    <include name="*.jar" />
                </fileset>
            </classpath>

            <fileset
                defaultexcludes="yes"
                dir="${src}" >

                <include name="**/*.java" />
            </fileset>

            <doctitle>
<![CDATA[<h1>JAnnot ${version}</h1>]]></doctitle>

            <bottom>
<![CDATA[<i>Copyright &#169; 2007-2013 - <a target="_blank" href="http://www.abeel.be/">Thomas Abeel</a> - All Rights Reserved.</i>]]><![CDATA[<a href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=208107&amp;type=1" width="88" height="31" border="0" alt="SourceForge.netLogo" /></a>]]></bottom>
        </javadoc>

        <zip
            basedir="${dist}"
            destfile="${dist}.zip" />

        <delete
            failonerror="false"
            file="${dist}.tar" />

        <delete
            dir="${dist}"
            failonerror="false" />

        <delete
            dir="${build}"
            failonerror="false" />
    </target>

</project>